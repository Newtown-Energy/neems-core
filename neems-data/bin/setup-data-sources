#!/bin/bash

# Setup script for neems-data sources
# Replaces the setup_sources.rs binary with simple CLI calls

echo "Setting up data sources..."

# Define the neems-data binary path (adjust if needed)
NEEMS_DATA=`which neems-data`

echo "Adding core data sources..."

# Core data sources
$NEEMS_DATA add current_time \
    --description "Current UTC timestamp and unix timestamp" \
    --interval 1 \
    --active

$NEEMS_DATA add ping_localhost \
    --description "Ping statistics for localhost (127.0.0.1)" \
    --interval 5 \
    --active

$NEEMS_DATA add random_digits \
    --description "Random integers, floats, and bytes" \
    --interval 2 \
    --active

$NEEMS_DATA add database_modtime \
    --description "Modification time of the database file" \
    --interval 10 \
    --active

$NEEMS_DATA add database_sha1 \
    --description "SHA1 hash of the database file" \
    --interval 30 \
    --active

$NEEMS_DATA add charging_state \
    --description "Calculates the current charging state (charging, discharging, hold)" \
    --interval 1 \
    --active

$NEEMS_DATA add time_sleep_3 \
    --description "Times how long it takes to run 'time sleep 3' command - slow 3+ second task" \
    --interval 30 \
    --active

echo "Adding battery-specific charging state sources..."

# Battery-specific charging state sources
for battery_id in battery_1 battery_2 battery_3; do
    $NEEMS_DATA add "charging_state_${battery_id}" \
        --description "Calculates the current charging state (charging, discharging, hold) for ${battery_id}" \
        --interval 1 \
        --active
done

echo ""
echo "Data source setup complete!"
echo ""
echo "To view all sources, run: $NEEMS_DATA list"
echo "To start monitoring, run: $NEEMS_DATA monitor"
